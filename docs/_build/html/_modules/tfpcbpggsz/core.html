<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tfpcbpggsz.core &mdash; TFPCBPGGSZ</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TFPCBPGGSZ
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TFPCBPGGSZ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tfpcbpggsz.core</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tfpcbpggsz.core</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uproot</span> <span class="k">as</span> <span class="nn">up</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">iminuit</span>
<span class="kn">from</span> <span class="nn">importlib.machinery</span> <span class="kn">import</span> <span class="n">SourceFileLoader</span>
<span class="kn">from</span> <span class="nn">tfpcbpggsz.masspdfs</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">tfpcbpggsz.phasecorrection</span> <span class="kn">import</span> <span class="n">PhaseCorrection</span>


<span class="c1">#Common functions</span>
<span class="n">_PI</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<div class="viewcode-block" id="DeltadeltaD">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DeltadeltaD">[docs]</a>
<span class="k">def</span> <span class="nf">DeltadeltaD</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">Abar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the phase difference between the amplitude and the conjugate amplitude</span>
<span class="sd">    </span>

<span class="sd">    Args:</span>
<span class="sd">        A (Amplitude): the amplitude from sample</span>
<span class="sd">        Abar (Amplitude Bar): the conjugate amplitude from sample</span>

<span class="sd">    Returns:</span>
<span class="sd">        float64: phase difference between the amplitude and the conjugate amplitude</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">var_a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Abar</span><span class="p">))</span><span class="o">+</span> <span class="n">_PI</span>
    <span class="n">var_b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">var_a</span> <span class="o">&gt;</span> <span class="n">_PI</span><span class="p">,</span> <span class="n">var_a</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">_PI</span><span class="p">,</span> <span class="n">var_a</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">var_b</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">_PI</span><span class="p">,</span> <span class="n">var_b</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">_PI</span><span class="p">,</span> <span class="n">var_b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">var</span></div>


<div class="viewcode-block" id="name_convert">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.name_convert">[docs]</a>
<span class="k">def</span> <span class="nf">name_convert</span><span class="p">(</span><span class="n">decay_str</span><span class="o">=</span><span class="s1">&#39;b2dk_LL_p&#39;</span><span class="p">):</span>


    <span class="n">decay_str</span> <span class="o">=</span> <span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b2dpi&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;DPi_KsPiPi_&#39;</span><span class="o">+</span><span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b2dk&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;DK_KsPiPi_&#39;</span><span class="o">+</span><span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">decay_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="clip_log">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.clip_log">[docs]</a>
<span class="k">def</span> <span class="nf">clip_log</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_epsilon</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;clip log to allowed large value&quot;&quot;&quot;</span>
    <span class="n">x_cut</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">_epsilon</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">_epsilon</span><span class="p">)</span>
    <span class="n">b_t</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_cut</span><span class="p">)</span>

    <span class="n">delta_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">_epsilon</span>
    <span class="n">b_f</span> <span class="o">=</span> <span class="p">(</span>
       <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_epsilon</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta_x</span> <span class="o">/</span> <span class="n">_epsilon</span> <span class="o">-</span> <span class="p">(</span><span class="n">delta_x</span> <span class="o">/</span> <span class="n">_epsilon</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">_epsilon</span><span class="p">,</span> <span class="n">b_t</span><span class="p">,</span> <span class="n">b_f</span><span class="p">)</span></div>


<div class="viewcode-block" id="dalitz_transform">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.dalitz_transform">[docs]</a>
<span class="k">def</span> <span class="nf">dalitz_transform</span><span class="p">(</span><span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">):</span>
    <span class="n">rotatedSymCoord</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_valid</span> <span class="o">+</span> <span class="n">x_valid</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>  <span class="c1">#z_+</span>
    <span class="n">rotatedAntiSymCoord</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_valid</span> <span class="o">-</span> <span class="n">x_valid</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1">#z_-</span>

    <span class="n">m1_</span> <span class="o">=</span> <span class="mf">2.23407421671132946</span>
    <span class="n">c1_</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.1171885586526695</span>
    <span class="n">m2_</span> <span class="o">=</span> <span class="mf">0.8051636393861085</span>
    <span class="n">c2_</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.54231895051727e-05</span>

    <span class="n">stretchedSymCoord</span> <span class="o">=</span> <span class="n">m1_</span> <span class="o">*</span> <span class="n">rotatedSymCoord</span> <span class="o">+</span> <span class="n">c1_</span>
    <span class="n">stretchedAntiSymCoord</span> <span class="o">=</span> <span class="n">m2_</span> <span class="o">*</span> <span class="n">rotatedAntiSymCoord</span> <span class="o">+</span> <span class="n">c2_</span>
    <span class="n">antiSym_scale</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">antiSym_offset</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">stretchedAntiSymCoord_dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">antiSym_scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">stretchedAntiSymCoord</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">antiSym_offset</span> <span class="o">+</span> <span class="n">stretchedSymCoord</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">stretchedSymCoord</span><span class="p">,</span> <span class="n">stretchedAntiSymCoord_dp</span><span class="p">])</span></div>


<div class="viewcode-block" id="eff_fun">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.eff_fun">[docs]</a>
<span class="k">def</span> <span class="nf">eff_fun</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="s1">&#39;dk_LL&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the efficiency value for the B2DK and B2Dpi decays</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># in GeV !!</span>
    <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">zp_p</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># $z_{+}^{\prime}</span>
    <span class="n">zm_pp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># $z_{-}^{\prime\prime}</span>
    <span class="n">Legendre_zp_1</span> <span class="o">=</span> <span class="n">zp_p</span>
    <span class="n">Legendre_zp_2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">Legendre_zp_3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">zp_p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">Legendre_zp_4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">35</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.</span>
    <span class="n">Legendre_zp_5</span> <span class="o">=</span> <span class="p">(</span><span class="mi">36</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">70</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">zp_p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.</span>
    <span class="n">Legendre_zp_6</span> <span class="o">=</span> <span class="p">(</span><span class="mi">231</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="mi">315</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">105</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zp_p</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.</span>
    <span class="n">Legendre_zm_2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zm_pp</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
    <span class="n">Legendre_zm_4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">35</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zm_pp</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zm_pp</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.</span>
    <span class="n">Legendre_zm_6</span> <span class="o">=</span> <span class="p">(</span><span class="mi">231</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zm_pp</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="mi">315</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zm_pp</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">105</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">zm_pp</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bp_b2dk_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">9.53264</span><span class="p">,</span> <span class="mf">30.6442</span><span class="p">,</span> <span class="o">-</span><span class="mf">70.1242</span><span class="p">,</span> <span class="o">-</span><span class="mf">171.659</span><span class="p">,</span> <span class="mf">20.997</span><span class="p">,</span> <span class="mf">111.455</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.7043</span><span class="p">,</span> <span class="o">-</span><span class="mf">208.538</span><span class="p">,</span> <span class="o">-</span><span class="mf">131.828</span><span class="p">,</span> <span class="mf">5.30961</span><span class="p">,</span> <span class="mf">38.3281</span><span class="p">,</span> <span class="mf">52.9287</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.1955</span><span class="p">,</span> <span class="o">-</span><span class="mf">92.5608</span><span class="p">,</span> <span class="o">-</span><span class="mf">53.7144</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.41475</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bm_b2dk_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">11.6916</span><span class="p">,</span> <span class="mf">36.6738</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.5949</span><span class="p">,</span> <span class="o">-</span><span class="mf">177.263</span><span class="p">,</span> <span class="mf">24.6625</span><span class="p">,</span> <span class="mf">128.041</span><span class="p">,</span> <span class="o">-</span><span class="mf">29.1374</span><span class="p">,</span> <span class="o">-</span><span class="mf">222.949</span><span class="p">,</span> <span class="o">-</span><span class="mf">133.375</span><span class="p">,</span> <span class="mf">5.42292</span><span class="p">,</span> <span class="mf">50.5985</span><span class="p">,</span> <span class="mf">63.6018</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.7697</span><span class="p">,</span> <span class="o">-</span><span class="mf">94.6231</span><span class="p">,</span> <span class="o">-</span><span class="mf">65.164</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.16556</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bp_b2dpi_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">11.726</span><span class="p">,</span> <span class="mf">36.3723</span><span class="p">,</span> <span class="o">-</span><span class="mf">79.9267</span><span class="p">,</span> <span class="o">-</span><span class="mf">178.024</span><span class="p">,</span> <span class="mf">26.746</span><span class="p">,</span> <span class="mf">125.069</span><span class="p">,</span> <span class="o">-</span><span class="mf">31.2218</span><span class="p">,</span> <span class="o">-</span><span class="mf">233.282</span><span class="p">,</span> <span class="o">-</span><span class="mf">133.757</span><span class="p">,</span> <span class="mf">6.55028</span><span class="p">,</span> <span class="mf">48.6604</span><span class="p">,</span> <span class="mf">59.0497</span><span class="p">,</span> <span class="o">-</span><span class="mf">43.2816</span><span class="p">,</span> <span class="o">-</span><span class="mf">99.2002</span><span class="p">,</span> <span class="o">-</span><span class="mf">65.8039</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.45939</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bm_b2dpi_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">11.2904</span><span class="p">,</span> <span class="mf">33.8601</span><span class="p">,</span> <span class="o">-</span><span class="mf">76.9433</span><span class="p">,</span> <span class="o">-</span><span class="mf">178.023</span><span class="p">,</span> <span class="mf">25.2621</span><span class="p">,</span> <span class="mf">118.649</span><span class="p">,</span> <span class="o">-</span><span class="mf">30.6079</span><span class="p">,</span> <span class="o">-</span><span class="mf">226.689</span><span class="p">,</span> <span class="o">-</span><span class="mf">135.131</span><span class="p">,</span> <span class="mf">5.66233</span><span class="p">,</span> <span class="mf">46.1495</span><span class="p">,</span> <span class="mf">57.1009</span><span class="p">,</span> <span class="o">-</span><span class="mf">45.8845</span><span class="p">,</span> <span class="o">-</span><span class="mf">98.3241</span><span class="p">,</span> <span class="o">-</span><span class="mf">65.0337</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.8956</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bp_b2dk_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">30.8217</span><span class="p">,</span> <span class="mf">98.3102</span><span class="p">,</span> <span class="o">-</span><span class="mf">201.671</span><span class="p">,</span> <span class="o">-</span><span class="mf">450.003</span><span class="p">,</span> <span class="mf">67.5668</span><span class="p">,</span> <span class="mf">336.798</span><span class="p">,</span> <span class="o">-</span><span class="mf">77.9681</span><span class="p">,</span> <span class="o">-</span><span class="mf">580.061</span><span class="p">,</span> <span class="o">-</span><span class="mf">337.139</span><span class="p">,</span> <span class="mf">17.1748</span><span class="p">,</span> <span class="mf">135.283</span><span class="p">,</span> <span class="mf">166.737</span><span class="p">,</span> <span class="o">-</span><span class="mf">108.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">248.926</span><span class="p">,</span> <span class="o">-</span><span class="mf">160.071</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.7914</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bm_b2dk_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">28.5793</span><span class="p">,</span> <span class="mf">92.1537</span><span class="p">,</span> <span class="o">-</span><span class="mf">192.655</span><span class="p">,</span> <span class="o">-</span><span class="mf">445.199</span><span class="p">,</span> <span class="mf">66.4849</span><span class="p">,</span> <span class="mf">315.014</span><span class="p">,</span> <span class="o">-</span><span class="mf">76.3822</span><span class="p">,</span> <span class="o">-</span><span class="mf">547.47</span><span class="p">,</span> <span class="o">-</span><span class="mf">336.686</span><span class="p">,</span> <span class="mf">17.0215</span><span class="p">,</span> <span class="mf">130.277</span><span class="p">,</span> <span class="mf">144.332</span><span class="p">,</span> <span class="o">-</span><span class="mf">112.366</span><span class="p">,</span> <span class="o">-</span><span class="mf">224.548</span><span class="p">,</span> <span class="o">-</span><span class="mf">150.207</span><span class="p">,</span> <span class="o">-</span><span class="mf">19.5028</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bp_b2dpi_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">25.1893</span><span class="p">,</span> <span class="mf">83.6515</span><span class="p">,</span> <span class="o">-</span><span class="mf">191.42</span><span class="p">,</span> <span class="o">-</span><span class="mf">437.186</span><span class="p">,</span> <span class="mf">59.6098</span><span class="p">,</span> <span class="mf">286.787</span><span class="p">,</span> <span class="o">-</span><span class="mf">79.8558</span><span class="p">,</span> <span class="o">-</span><span class="mf">540.406</span><span class="p">,</span> <span class="o">-</span><span class="mf">331.55</span><span class="p">,</span> <span class="mf">13.7906</span><span class="p">,</span> <span class="mf">114.149</span><span class="p">,</span> <span class="mf">135.039</span><span class="p">,</span> <span class="o">-</span><span class="mf">114.09</span><span class="p">,</span> <span class="o">-</span><span class="mf">219.42</span><span class="p">,</span> <span class="o">-</span><span class="mf">167.023</span><span class="p">,</span> <span class="o">-</span><span class="mf">22.0707</span> <span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bm_b2dpi_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">27.3281</span><span class="p">,</span> <span class="mf">77.6543</span><span class="p">,</span> <span class="o">-</span><span class="mf">181.93</span><span class="p">,</span> <span class="o">-</span><span class="mf">451.338</span><span class="p">,</span> <span class="mf">51.6441</span><span class="p">,</span> <span class="mf">278.849</span><span class="p">,</span> <span class="o">-</span><span class="mf">66.5276</span><span class="p">,</span> <span class="o">-</span><span class="mf">522.833</span><span class="p">,</span> <span class="o">-</span><span class="mf">353.474</span><span class="p">,</span> <span class="mf">11.865</span><span class="p">,</span> <span class="mf">98.5612</span><span class="p">,</span> <span class="mf">138.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.508</span><span class="p">,</span> <span class="o">-</span><span class="mf">228.435</span><span class="p">,</span> <span class="o">-</span><span class="mf">139.317</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.4476</span> <span class="p">]</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bp_b2dk_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">57.060094380400386</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bm_b2dk_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">58.17587468590285</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bp_b2dk_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">144.4818375757835</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bm_b2dk_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">149.4970954503175</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bp_b2dpi_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">58.02066608312892</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bm_b2dpi_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">57.2679149533671</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bp_b2dpi_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">143.85275330726384</span>
    <span class="n">offset</span><span class="p">[</span><span class="s1">&#39;bm_b2dpi_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">145.64578485313336</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bp_b2dk_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">94.71806024672841</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bm_b2dk_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">95.67192393339243</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bp_b2dk_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">236.7559605125362</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bm_b2dk_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">243.96305838750337</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bp_b2dpi_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">95.5957545077163</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bm_b2dpi_LL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">95.47377527333916</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bp_b2dpi_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">238.0281142413688</span>
    <span class="n">mean</span><span class="p">[</span><span class="s1">&#39;bm_b2dpi_DD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">241.6462132232453</span>

    <span class="n">decay</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="o">+</span><span class="n">charge</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">decay</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_1</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_2</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_2</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_3</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_1</span> <span class="o">*</span> <span class="n">Legendre_zm_2</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_4</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_2</span> <span class="o">*</span> <span class="n">Legendre_zm_2</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_4</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_5</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_2</span> <span class="o">*</span> <span class="n">Legendre_zp_3</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_4</span> <span class="o">*</span> <span class="n">Legendre_zp_1</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_6</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_4</span> <span class="o">*</span> <span class="n">Legendre_zp_2</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">14</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zm_2</span> <span class="o">*</span> <span class="n">Legendre_zp_4</span>
        <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="mi">15</span><span class="p">]</span> <span class="o">*</span> <span class="n">Legendre_zp_6</span>
    <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">res</span><span class="o">+</span><span class="n">offset</span><span class="p">[</span><span class="n">decay</span><span class="p">])</span><span class="o">/</span><span class="n">mean</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span></div>


<div class="viewcode-block" id="prob_totalAmplitudeSquared_XY">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.prob_totalAmplitudeSquared_XY">[docs]</a>
<span class="k">def</span> <span class="nf">prob_totalAmplitudeSquared_XY</span><span class="p">(</span><span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="p">[],</span> <span class="n">ampbar</span><span class="o">=</span><span class="p">[],</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">pc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the amplitude squared for the B2DK and B2Dpi decays</span>

<span class="sd">    Args:</span>
<span class="sd">        Bsign (int, optional): the charge of B meson. Defaults to 1.</span>
<span class="sd">        amp (Amplitude): the amplitude from sample</span>
<span class="sd">        ampbar (Amplitude Bar): the conjugate amplitude from sample</span>
<span class="sd">        x (tuple, optional): the fitted params. Defaults to (0,0,0,0,0,0).</span>
<span class="sd">        pc (float, optional): the phase correction class. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float64: the amplitude squared</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">ampbar</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">pc</span>

    <span class="n">absA</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ampbar</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span>
    
    <span class="k">elif</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span></div>


<div class="viewcode-block" id="prob_totalAmplitudeSquared_CP_mix">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.prob_totalAmplitudeSquared_CP_mix">[docs]</a>
<span class="k">def</span> <span class="nf">prob_totalAmplitudeSquared_CP_mix</span><span class="p">(</span><span class="n">amp_sig</span><span class="o">=</span><span class="p">[],</span> <span class="n">ampbar_sig</span><span class="o">=</span><span class="p">[],</span><span class="n">amp_tag</span><span class="o">=</span><span class="p">[],</span> <span class="n">ampbar_tag</span><span class="o">=</span><span class="p">[],</span> <span class="n">pc_sig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pc_tag</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the amplitude squared for the D0-&gt;KsPiPi and D0bar-&gt;KsPiPi decays</span>

<span class="sd">    Args:</span>
<span class="sd">        amp_sig (Amplitude): the amplitude from signal sample</span>
<span class="sd">        ampbar_sig (Amplitude Bar): the conjugate amplitude from signal sample</span>
<span class="sd">        amp_tag (Amplitude): the amplitude from tag sample</span>
<span class="sd">        ampbar_tag (Amplitude Bar): the conjugate amplitude from tag sample</span>
<span class="sd">        pc_sig (float, optional): the phase correction for the signal. Defaults to None.</span>
<span class="sd">        pc_tag (float, optional): the phase correction for the tag. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float64: the amplitude squared</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">phase_sig</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="n">amp_sig</span><span class="p">,</span> <span class="n">ampbar_sig</span><span class="p">)</span>
    <span class="n">phase_tag</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="n">amp_tag</span><span class="p">,</span> <span class="n">ampbar_tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pc_sig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">phase_sig</span> <span class="o">=</span> <span class="n">phase_sig</span> <span class="o">+</span> <span class="n">pc_sig</span>
    <span class="k">if</span> <span class="n">pc_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">phase_tag</span> <span class="o">=</span> <span class="n">phase_tag</span> <span class="o">+</span> <span class="n">pc_tag</span>

    <span class="n">absA_sig</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp_sig</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absAbar_sig</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ampbar_sig</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absA_tag</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp_tag</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absAbar_tag</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ampbar_tag</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">absA_sig</span><span class="o">*</span><span class="n">absAbar_tag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">absAbar_sig</span><span class="o">*</span><span class="n">absA_tag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">absA_sig</span><span class="o">*</span><span class="n">absAbar_tag</span><span class="o">*</span><span class="n">absAbar_sig</span><span class="o">*</span><span class="n">absA_tag</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase_sig</span><span class="o">-</span><span class="n">phase_tag</span><span class="p">)</span></div>


<div class="viewcode-block" id="prob_totalAmplitudeSquared_CP_tag">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.prob_totalAmplitudeSquared_CP_tag">[docs]</a>
<span class="k">def</span> <span class="nf">prob_totalAmplitudeSquared_CP_tag</span><span class="p">(</span><span class="n">CPsign</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="p">[],</span> <span class="n">ampbar</span><span class="o">=</span><span class="p">[],</span> <span class="n">pc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the amplitude squared for the CP tag decay</span>

<span class="sd">    Args:</span>
<span class="sd">        CPsign (int, optional): the CP sign for the decay. Defaults to +.</span>
<span class="sd">        amp (Amplitude): the amplitude from sample</span>
<span class="sd">        ampbar (Amplitude Bar): the conjugate amplitude from sample</span>
<span class="sd">        pc (float, optional): the phase correction class. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float64: the amplitude squared</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="n">DDsign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">ampbar</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">pc</span>

    <span class="n">absA</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ampbar</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>



    <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">DDsign</span> <span class="o">*</span> <span class="n">CPsign</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">))</span></div>


<div class="viewcode-block" id="prob_totalAmplitudeSquared_DPi_XY">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.prob_totalAmplitudeSquared_DPi_XY">[docs]</a>
<span class="k">def</span> <span class="nf">prob_totalAmplitudeSquared_DPi_XY</span><span class="p">(</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="p">[],</span> <span class="n">ampbar</span><span class="o">=</span><span class="p">[],</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the amplitude squared for the B2Dpi decay, the ratio between B2DK and B2Dpi is used, then two additional parameters are added</span>

<span class="sd">    Args:</span>
<span class="sd">        Bsign (int, optional): the charge of B meson. Defaults to 1.</span>
<span class="sd">        amp (Amplitude): the amplitude from sample</span>
<span class="sd">        ampbar (Amplitude Bar): the conjugate amplitude from sample</span>
<span class="sd">        x (tuple, optional): the fitted params. Defaults to (0,0,0,0,0,0,0,0,0,0,0,0,0,0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        float64: the amplitude squared</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phase</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="n">amp</span><span class="p">,</span> <span class="n">ampbar</span><span class="p">)</span>
    <span class="n">absA</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ampbar</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="n">xXi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">yXi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">xPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xPlus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">yPlus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span>
    
    <span class="k">elif</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">xMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>


        <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xMinus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">yMinus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span></div>



<div class="viewcode-block" id="prob_comb">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.prob_comb">[docs]</a>
<span class="k">def</span> <span class="nf">prob_comb</span><span class="p">(</span><span class="n">amp</span><span class="o">=</span><span class="p">[],</span> <span class="n">ampbar</span><span class="o">=</span><span class="p">[],</span> <span class="n">normA</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">normAbar</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">fracDD</span><span class="o">=</span><span class="mf">0.82</span><span class="p">,</span> <span class="n">eff1</span><span class="o">=</span><span class="p">[],</span> <span class="n">eff2</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate the amplitude squared for the combinatorial background in the B2DK and B2Dpi decays</span>

<span class="sd">    Args:</span>
<span class="sd">        amp (Amplitude): the amplitude from sample</span>
<span class="sd">        ampbar (Amplitude Bar): the conjugate amplitude from sample</span>
<span class="sd">        normA (float, optional): the normalisation of the amplitude squared for the decay. Defaults to 1.2.</span>
<span class="sd">        normAbar (float, optional): the normalisation of the amplitude squared for the decay. Defaults to 1.2.</span>
<span class="sd">        fracDD (float, optional): the fraction of the combinatorial background. Defaults to 0.82.</span>
<span class="sd">        eff1 (float, optional): the efficiency value for the B2DK decay. Defaults to [].</span>
<span class="sd">        eff2 (float, optional): the efficiency value for the B2Dpi decay. Defaults to [].</span>

<span class="sd">    Returns:</span>
<span class="sd">        float64: the amplitude squared</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">absA</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ampbar</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">normA</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">normAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normAbar</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">frac1</span> <span class="o">=</span> <span class="n">fracDD</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="n">frac2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">fracDD</span>
    <span class="n">prob1</span> <span class="o">=</span> <span class="n">eff1</span><span class="o">*</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="n">normA</span>
    <span class="n">prob2</span> <span class="o">=</span> <span class="n">eff2</span><span class="o">*</span><span class="n">absAbar</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="n">normAbar</span> 
    <span class="n">prob3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">absA</span><span class="p">)</span>


    <span class="k">return</span> <span class="p">(</span><span class="n">prob1</span> <span class="o">*</span> <span class="n">frac1</span> <span class="o">+</span> <span class="n">prob2</span> <span class="o">*</span> <span class="n">frac1</span> <span class="o">+</span> <span class="n">prob3</span> <span class="o">*</span> <span class="n">frac2</span><span class="p">)</span></div>


<span class="c1">#Probabily just for validation stage, should be more general for the Normalisation class</span>
<div class="viewcode-block" id="Normalisation_Charm">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm">[docs]</a>
<span class="k">class</span> <span class="nc">Normalisation_Charm</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalisation class, contains the formula we need with charm dataset</span>
<span class="sd">    Args:</span>
<span class="sd">        amp_MC: dict, dictionary of the amplitude for the MC</span>
<span class="sd">        ampbar_MC: dict, dictionary of the conjugate amplitude for the MC</span>
<span class="sd">        name: str, decay name, e.g. b2dk</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amp_MC</span><span class="p">,</span> <span class="n">ampbar_MC</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;b2dk&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span> <span class="o">=</span> <span class="n">amp_MC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span> <span class="o">=</span> <span class="n">ampbar_MC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Abar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_A_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Abar_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_complex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_bkg</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection_tag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tagged_i</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Normalisation_Charm.add_pc">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.add_pc">[docs]</a>
    <span class="k">def</span> <span class="nf">add_pc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pc</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to add the phase correction to the phase</span>

<span class="sd">        Args:</span>
<span class="sd">            pc (float): the phase correction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pc_tag&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection_tag</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pc_tag&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection</span> <span class="o">=</span> <span class="n">pc</span></div>


<div class="viewcode-block" id="Normalisation_Charm.debug">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.debug">[docs]</a>
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DEBUG</span> <span class="o">=</span> <span class="kc">True</span></div>

        
<div class="viewcode-block" id="Normalisation_Charm.initialise">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.initialise">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to initialise the normalisation terms</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialising normalisation for decay:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normA</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normAbar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AAbar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normalisation terms:</span><span class="se">\n</span><span class="s1"> |A|^2:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> |Abar|^2:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> |A||Abar|cos(phase):&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> |A||Abar| sin(phase):&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="Normalisation_Charm.initialise_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.initialise_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>     
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to initialise the normalisation terms for the misid decay</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialising misid normalisation for decay:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Misid amplitude not found&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">normA_misid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normAbar_misid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AAbar_misid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_misid</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEBUG</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Normalisation terms:</span><span class="se">\n</span><span class="s1"> |A|^2:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> |Abar|^2:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> |A||Abar| cos(phase):&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> |A||Abar| sin(phase):&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="Normalisation_Charm.setParams">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.setParams">[docs]</a>
    <span class="k">def</span> <span class="nf">setParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">x</span></div>


<div class="viewcode-block" id="Normalisation_Charm.phase">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.phase">[docs]</a>
    <span class="k">def</span> <span class="nf">phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the phase related terms, including:</span>
<span class="sd">        .. math::</span>

<span class="sd">           \begin{aligned}</span>
<span class="sd">           \delta_D &amp;= \\</span>
<span class="sd">           |A||\bar{A}| \cos(\delta_D) &amp;= \\</span>
<span class="sd">           |A||\bar{A}| \sin(\delta_D) &amp;= \\</span>
<span class="sd">           |A_{sig}|^2 |\bar{A}_{tag}|^2 + |\bar{A}_{sig}|^2 |A_{tag}|^2 - 2 |A||\bar{A}| |\bar{A}_{sig}||A_{tag}| \cos(\delta_D - \delta_{D_{tag}})</span>
<span class="sd">           \end{aligned} </span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: phase between the amplitude and the conjugate amplitude</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phase_tag</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged_i</span><span class="p">)</span> <span class="c1">#+ phase_correction.eval_tf(tf.gather(events, tagged_i))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_complex</span> <span class="o">=</span>  <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Abar_tag</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Abar</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A_tag</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_tag</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_tag</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span></div>


<div class="viewcode-block" id="Normalisation_Charm.normA">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.normA">[docs]</a>
    <span class="k">def</span> <span class="nf">normA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the normalisation of the amplitude squared for the decay.</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: </span>
<span class="sd">        </span>
<span class="sd">        .. math: |A|^2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tagged_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_A_tag</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged_i</span><span class="p">)</span>

            <span class="c1">#if self._name[3] == &#39;p&#39; and self._name[-1] == &#39;m&#39;:</span>
            <span class="c1">#    self._BacTerms_bkg[0] = self._normA</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span></div>

    
<div class="viewcode-block" id="Normalisation_Charm.normAbar">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.normAbar">[docs]</a>
    <span class="k">def</span> <span class="nf">normAbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the normalisation of the amplitude squared for the decay.</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: </span>
<span class="sd">        </span>
<span class="sd">        .. math: |Abar|^2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Abar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Abar_tag</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Abar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged_i</span><span class="p">)</span>
            <span class="c1">#if self._name[3] == &#39;p&#39; and self._name[-1] == &#39;p&#39;:</span>
            <span class="c1">#    self._BacTerms_bkg[1] = self._normAbar</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span></div>


<div class="viewcode-block" id="Normalisation_Charm.AAbar">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.AAbar">[docs]</a>
    <span class="k">def</span> <span class="nf">AAbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the product of the amplitude and the conjugate amplitude for the decay.</span>

<span class="sd">        Returns:</span>
<span class="sd">            </span>
<span class="sd">        float64:</span>

<span class="sd">        .. math:: |A| |\bar{A}| </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">])</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_tag</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A_tag</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Abar_tag</span><span class="p">)</span> 

            <span class="c1">#tagged_i = (tf.range(self.AAbar.shape[0]) + self.AAbar.shape[0] // 2) % self.AAbar.shape[0]</span>
            <span class="c1">#self._AAbar_tag = tf.abs(tf.gather(self.amp_MC[self._name],tagged_i)) * tf.abs(tf.gather(self.ampbar_MC[self._name],tagged_i))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_tag</span></div>


<div class="viewcode-block" id="Normalisation_Charm.Update_crossTerms">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Update_crossTerms">[docs]</a>
    <span class="k">def</span> <span class="nf">Update_crossTerms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the cross terms between the amplitude and the conjugate amplitude.</span>
<span class="sd">        if there is a phase correction, it will be added to the phase</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: </span>

<span class="sd">        .. math:: |A| |\bar{A}| \cos(\delta_D), |A| |\bar{A}| \sin(\delta_D)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection_tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_complex</span> <span class="o">=</span>  <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span>
                <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Abar_tag</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Abar</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_A_tag</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_tag</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_tag</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_phaseCorrection_tag</span><span class="p">)</span>
                <span class="p">)</span>
    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span></div>


<div class="viewcode-block" id="Normalisation_Charm.Integrated_BacTerms">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_BacTerms">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_BacTerms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the Bachelor terms for the decay </span>

<span class="sd">        .. math:: |A|^2, |Abar|^2</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: </span>

<span class="sd">        .. math:: |A|^2, |Abar|^2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms</span></div>

    
<div class="viewcode-block" id="Normalisation_Charm.Integrated_4p">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_4p">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_4p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. math:: A^2 * rb^2 + Abar^2 + 2*|A||Abar| * rb * cos(deltaB + gamma + deltaD)</span>
<span class="sd">    </span>
<span class="sd">        .. math:: A^2 + Abar^2 * rb^2 + 2*|A||Abar| * rb * cos(deltaB + gamma - deltaD)</span>

<span class="sd">        Args:</span>
<span class="sd">        Bsign: int, 1 for B+ and -1 for B-</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: Integrated amplitude squared, the normalisation is taking from the misid decay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please calculate the normalisation and cross terms first&#39;</span><span class="p">)</span>
        
        <span class="n">normA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span>
        <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span>
        <span class="n">crossTerm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>


        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="n">normAbar</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">+</span> <span class="n">normAbar</span>  <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>    </div>


<div class="viewcode-block" id="Normalisation_Charm.Integrated_4p_sig">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_4p_sig">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_4p_sig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. math:: </span>

<span class="sd">        A^2 * rb^2 + Abar^2 + 2*|A||Abar| * rb * cos(deltaB + gamma + deltaD)</span>
<span class="sd">    </span>
<span class="sd">        A^2 + Abar^2 * rb^2 + 2*|A||Abar| * rb * cos(deltaB + gamma - deltaD)</span>

<span class="sd">        Args:</span>
<span class="sd">        Bsign: int, 1 for B+ and -1 for B-</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: Integrated amplitude squared, the normalisation is taking from the signal decay</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please calculate the normalisation and cross terms first&#39;</span><span class="p">)</span>
        
        <span class="n">normA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span>
        <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span>
        <span class="n">crossTerm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>


        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="n">normAbar</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">+</span> <span class="n">normAbar</span>  <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>    </div>



<div class="viewcode-block" id="Normalisation_Charm.Integrated_CP_tag">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_CP_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_CP_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CPsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. math:: </span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">        A^2 * rb^2 + \bar{A}^2 + DDsign*CPsign* 2*|A||Abar| * rb * cos(\delta_B + \gamma + \delta_D)</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">        - With Psi(3770), DDsign = -1</span>


<span class="sd">        Args:</span>
<span class="sd">            CPsign (int, optional): the CP sign for the decay. Defaults to +.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float64: Integrated amplitude squared, the normalisation is taking from the signal decay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please calculate the normalisation and cross terms first&#39;</span><span class="p">)</span>
        
        <span class="n">DD_sign</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">normA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span>
        <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span>
        <span class="n">crossTerm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span>

        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">+</span> <span class="n">normAbar</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">DD_sign</span><span class="o">*</span> <span class="n">CPsign</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>



<div class="viewcode-block" id="Normalisation_Charm.Integrated_4p_a">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_4p_a">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_4p_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. math::  A^2 * rb^2 + Abar^2 + 2*|A||Abar| * rb * cos(deltaB + gamma + deltaD)</span>


<span class="sd">        Args:</span>
<span class="sd">            Bsign (int, optional): the charge of B meson. Defaults to 1.</span>
<span class="sd">            x (tuple, optional): the fitted params. Defaults to (0,0,0,0).</span>

<span class="sd">        Returns:</span>
<span class="sd">            float64: Integrated amplitude squared, the normalisation is taking from the signal decay</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please calculate the normalisation and cross terms first&#39;</span><span class="p">)</span>
        
        <span class="n">normA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span>
        <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span>
        <span class="n">crossTerm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span>


        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="n">normAbar</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">+</span> <span class="n">normAbar</span>  <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> </div>



<div class="viewcode-block" id="Normalisation_Charm.Integrated_fullchain">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_fullchain">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_fullchain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        .. math:: </span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">        A^2 * rb^2 + Abar^2 + 2*|A||Abar| * rb * cos(deltaB + gamma + deltaD)</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">        Args:</span>
<span class="sd">            Bsign (int, optional): the charge of B meson. Defaults to 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float64: Integrated amplitude squared, the normalisation is taking from the signal decay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
        <span class="n">absA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span>
        <span class="n">absAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="n">absA</span><span class="p">,</span> <span class="n">absAbar</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="n">Gp</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="n">absAbar</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">Gp</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">Gm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">absAbar</span><span class="o">**</span><span class="mi">2</span>  <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">Gm</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Normalisation_Charm.phase_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.phase_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">phase_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the phase between the amplitude and the conjugate amplitude for the misid decay.</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: phase between the amplitude and the conjugate amplitude for the misid decay</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span></div>

    

<div class="viewcode-block" id="Normalisation_Charm.normA_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.normA_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">normA_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the normalisation of the amplitude squared for the decay.</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: </span>
<span class="sd">        </span>
<span class="sd">        .. math:: |A|^2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span>
            <span class="c1">#if self._name[3] == &#39;k&#39; and self._name[-1] == &#39;m&#39;:</span>
            <span class="c1">#    self._BacTerms_bkg[0] = self._normA_misid</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span></div>

    
<div class="viewcode-block" id="Normalisation_Charm.normAbar_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.normAbar_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">normAbar_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the normalisation of the amplitude squared for the decay.</span>

<span class="sd">        Returns:</span>

<span class="sd">        float64: </span>

<span class="sd">        .. math:: |\bar{A}|^2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span>
            <span class="c1">#if self._name[3] == &#39;k&#39; and self._name[-1] == &#39;p&#39;:</span>
            <span class="c1">#    self._BacTerms_bkg[1] = self._normAbar_misid</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span></div>


<div class="viewcode-block" id="Normalisation_Charm.AAbar_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.AAbar_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">AAbar_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the product of the amplitude and the conjugate amplitude for the decay.</span>

<span class="sd">        Returns:</span>

<span class="sd">        float64:    </span>

<span class="sd">        .. math:: |A||\bar{A}|</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">])</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">])</span>
    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span></div>


<div class="viewcode-block" id="Normalisation_Charm.Integrated_crossTerms_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_crossTerms_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_crossTerms_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the cross terms between the amplitude and the conjugate amplitude for the misid decay.</span>

<span class="sd">        Returns:</span>
<span class="sd">        </span>
<span class="sd">        float64: </span>

<span class="sd">        .. math:: </span>

<span class="sd">        \begin{aligned}</span>
<span class="sd">        | A || \bar{A}| cos(\delta_D)</span>
<span class="sd">        | A || \bar{A}| sin(\delta_D)</span>
<span class="sd">        \end{aligned}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AAbar_misid</span><span class="o">*</span><span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_phase_misid</span><span class="p">))</span>
    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span></div>


<div class="viewcode-block" id="Normalisation_Charm.Integrated_BacTerms_misid">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_BacTerms_misid">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_BacTerms_misid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function calculates the Bachelor terms for the misid decay </span>
<span class="sd">        </span>
<span class="sd">        .. math:: |A|^2, |Abar|^2</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: </span>

<span class="sd">        .. math:: |A|^2, |Abar|^2</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_MC</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_misid</span><span class="p">]))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BacTerms_misid</span></div>

    
        
<div class="viewcode-block" id="Normalisation_Charm.Integrated_6p">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_6p">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_6p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. math::</span>
<span class="sd">        </span>
<span class="sd">        \begin{aligned}</span>
<span class="sd">        \Gamma_+ =  A^2 * rb^2 + Abar^2 + 2*|A||Abar| * rb * cos(deltaB + gamma + deltaD)</span>
<span class="sd">    </span>
<span class="sd">        \Gamma_- =  A^2 + Abar^2 * rb^2 + 2*|A||Abar| * rb * cos(deltaB + gamma - deltaD)</span>

<span class="sd">        \end{aligned}</span>

<span class="sd">        Args:</span>
<span class="sd">        Bsign: int, 1 for B+ and -1 for B-</span>

<span class="sd">        Returns:</span>

<span class="sd">        float64: Integrated amplitude squared, the normalisation is taking from the misid decay</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x should have 6 elements&#39;</span><span class="p">)</span>
        
        <span class="n">xXi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yXi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">normA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA_misid</span>
        <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar_misid</span>
        <span class="n">crossTerm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms_misid</span>

        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">xPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="n">normAbar</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xPlus_DPi</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">yPlus_DPi</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">xMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">+</span> <span class="n">normAbar</span>  <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xMinus_DPi</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yMinus_DPi</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>


<div class="viewcode-block" id="Normalisation_Charm.Integrated_6p_sig">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.Normalisation_Charm.Integrated_6p_sig">[docs]</a>
    <span class="k">def</span> <span class="nf">Integrated_6p_sig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. math:: A^2 * rb^2 + Abar^2 + 2*|A||Abar| * rb * cos(deltaB + gamma + deltaD)</span>
<span class="sd">    </span>
<span class="sd">        .. math:: A^2 + Abar^2 * rb^2 + 2*|A||Abar| * rb * cos(deltaB + gamma - deltaD)</span>

<span class="sd">        Args:</span>
<span class="sd">        Bsign: int, 1 for B+ and -1 for B-</span>

<span class="sd">        Returns:</span>
<span class="sd">        float64: Integrated amplitude squared, the normalisation is taking from the signal decay</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x should have 6 elements&#39;</span><span class="p">)</span>
        
        <span class="n">xXi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">yXi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">normA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normA</span>
        <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normAbar</span>
        <span class="n">crossTerm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crossTerms</span>

        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">xPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="n">normAbar</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xPlus_DPi</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">yPlus_DPi</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">xMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">normA</span> <span class="o">+</span> <span class="n">normAbar</span>  <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span><span class="p">(</span><span class="n">xMinus_DPi</span> <span class="o">*</span><span class="n">crossTerm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yMinus_DPi</span> <span class="o">*</span> <span class="n">crossTerm</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>
</div>




<div class="viewcode-block" id="DecayNLLCalculator">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator">[docs]</a>
<span class="k">class</span> <span class="nc">DecayNLLCalculator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to calculate negative log-likelihood for various decay types.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amp_data</span><span class="p">,</span> <span class="n">ampbar_data</span><span class="p">,</span> <span class="n">normalisations</span><span class="p">,</span> <span class="n">mass_pdfs</span><span class="p">,</span> <span class="n">eff_arr</span><span class="p">,</span> <span class="n">fracDD</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B2DK&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_data</span> <span class="o">=</span> <span class="n">amp_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_data</span> <span class="o">=</span> <span class="n">ampbar_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_pdfs</span> <span class="o">=</span> <span class="n">mass_pdfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span> <span class="o">=</span> <span class="n">eff_arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fracDD</span> <span class="o">=</span> <span class="n">fracDD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span> <span class="o">=</span> <span class="n">normalisations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nll</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prod_prob</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_absA</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase_correction</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="DecayNLLCalculator.initialise">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.initialise">[docs]</a>
    <span class="k">def</span> <span class="nf">initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise the amplitude and phase.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">charge</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialising amplitude and phase for decay:&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_data</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ampbar_data</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DeltadeltaD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_data</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ampbar_data</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">norm_bkg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_prob</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_prod_prob</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nll</span><span class="p">()</span></div>

        <span class="c1">#print(&#39;Negative log-likelihood:&#39;, self._nll)</span>

<div class="viewcode-block" id="DecayNLLCalculator.norm_bkg">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.norm_bkg">[docs]</a>
    <span class="k">def</span> <span class="nf">norm_bkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]:</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">charge</span>
            <span class="n">decay_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_p&#39;</span>
            <span class="n">decay_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_m&#39;</span>
            <span class="c1">#Making sure it is always the DPi events as normalisation</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay_m</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay_p</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_misid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="c1">#For Dpi, prepare for the upgrated version</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay_m</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay_p</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span></div>






<div class="viewcode-block" id="DecayNLLCalculator.norm">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.norm">[docs]</a>
    <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the normalisation of the amplitude squared.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]:</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">charge</span>
            <span class="n">charge_flag</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">decay</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">Integrated_4p_sig</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">Integrated_6p</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">Integrated_6p_sig</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">Integrated_4p</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span>


            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1">#print(&#39;Calculating normalisation for decay:&#39;, decay)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;comb_a&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;comb_abar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="c1">#Only for DK mode</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_misID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_Bs2DKPi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="c1">#Only for DK mode</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_misID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_Bs2DKPi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">_BacTerms_bkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


                    

<div class="viewcode-block" id="DecayNLLCalculator.make_prob">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.make_prob">[docs]</a>
    <span class="k">def</span> <span class="nf">make_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the Amplitude PDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
   
        <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]:</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">charge</span>
            <span class="n">charge_flag</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">decay</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_XY</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;comb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_comb</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_low</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_DPi_XY</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_DPi_XY</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_DPi_XY</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_XY</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;misid&#39;</span><span class="p">]</span>
                    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_misID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_low</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_misID&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_Bs2DKPi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;comb_a&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_low_Bs2DKPi</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_Bs2DKPi&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_Bs2DKPi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;comb_abar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalAmplitudeSquared_low_Bs2DKPi</span><span class="p">(</span><span class="n">charge_flag</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="s1">&#39;low_Bs2DKPi&#39;</span><span class="p">]</span></div>



<div class="viewcode-block" id="DecayNLLCalculator.make_prod_prob">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.make_prod_prob">[docs]</a>
    <span class="k">def</span> <span class="nf">make_prod_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the negative log-likelihood.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]:</span>
                <span class="n">decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">charge</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prod_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ret</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_pdfs</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_pdfs</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="n">keys</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_prod_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_pdfs</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="n">keys</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="n">keys</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_ret</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_pdfs</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="n">keys</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span><span class="p">[</span><span class="n">decay</span><span class="p">][</span><span class="n">keys</span><span class="p">]</span></div>

                    <span class="c1">#else:</span>
                    <span class="c1">#    print(f&#39;Mass PDF {keys} is empty for decay {decay}&#39;)</span>

<div class="viewcode-block" id="DecayNLLCalculator.nll">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.nll">[docs]</a>
    <span class="k">def</span> <span class="nf">nll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the negative log-likelihood.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">charge</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]:</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">charge</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nll</span><span class="p">[</span><span class="n">decay</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">clip_log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ret</span><span class="p">[</span><span class="n">decay</span><span class="p">]))</span></div>


<div class="viewcode-block" id="DecayNLLCalculator.totalAmplitudeSquared_XY">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.totalAmplitudeSquared_XY">[docs]</a>
    <span class="k">def</span> <span class="nf">totalAmplitudeSquared_XY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_p&#39;</span> <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">absA</span><span class="p">,</span> <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span><span class="p">,</span> <span class="n">yPlus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span>
        
        <span class="k">elif</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">xMinus</span><span class="p">,</span> <span class="n">yMinus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span></div>

    
<div class="viewcode-block" id="DecayNLLCalculator.totalAmplitudeSquared_low">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.totalAmplitudeSquared_low">[docs]</a>
    <span class="k">def</span> <span class="nf">totalAmplitudeSquared_low</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the amplitude squared for the low mass contribution.</span>

<span class="sd">        Args:</span>
<span class="sd">        Bsign: int: 1 or -1</span>
<span class="sd">        norm: float: normalisation factor for the amplitude squared</span>

<span class="sd">        Returns:</span>
<span class="sd">        float: probability for the low mass contribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_p&#39;</span> <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span><span class="c1">#If Bsign is -1, then for the low_Bs2DKPi, it will take the amplitude from opposite charge B, which is wrong</span>
        <span class="n">absA</span><span class="p">,</span> <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    
        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">absAbar</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">absA</span><span class="o">**</span><span class="mi">2</span></div>


<div class="viewcode-block" id="DecayNLLCalculator.totalAmplitudeSquared_low_Bs2DKPi">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.totalAmplitudeSquared_low_Bs2DKPi">[docs]</a>
    <span class="k">def</span> <span class="nf">totalAmplitudeSquared_low_Bs2DKPi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the amplitude squared for the low mass contribution.</span>

<span class="sd">        Args:</span>
<span class="sd">        Bsign: int: 1 or -1</span>
<span class="sd">        norm: float: normalisation factor for the amplitude squared</span>

<span class="sd">        Returns:</span>
<span class="sd">        float: probability for the low mass contribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_p&#39;</span> <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span>
        <span class="n">absA</span><span class="p">,</span> <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    
        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">absA</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">absAbar</span><span class="o">**</span><span class="mi">2</span></div>


<div class="viewcode-block" id="DecayNLLCalculator.totalAmplitudeSquared_DPi_XY">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.totalAmplitudeSquared_DPi_XY">[docs]</a>
    <span class="k">def</span> <span class="nf">totalAmplitudeSquared_DPi_XY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_p&#39;</span> <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">absA</span><span class="p">,</span> <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="n">xXi</span><span class="p">,</span> <span class="n">yXi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xPlus</span><span class="p">,</span> <span class="n">yPlus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">xPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yPlus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yPlus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xPlus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xPlus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yPlus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xPlus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">yPlus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span><span class="c1">#/self._normalisations[name][&#39;misid&#39;]</span>
        
        <span class="k">elif</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>


            <span class="n">xMinus</span><span class="p">,</span> <span class="n">yMinus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">xMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">-</span> <span class="n">yMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">yMinus_DPi</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">yMinus</span> <span class="o">*</span> <span class="n">xXi</span> <span class="o">+</span> <span class="n">xMinus</span> <span class="o">*</span> <span class="n">yXi</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">rB2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">xMinus_DPi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yMinus_DPi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    
    
            <span class="k">return</span> <span class="p">(</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">absAbar</span> <span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">rB2</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">absA</span> <span class="o">*</span> <span class="n">absAbar</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xMinus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">yMinus_DPi</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)))</span><span class="c1">#/self._normalisations[name][&#39;misid&#39;]</span></div>

        
<div class="viewcode-block" id="DecayNLLCalculator.totalAmplitudeSquared_comb">
<a class="viewcode-back" href="../../tfpcbpggsz.core.html#tfpcbpggsz.core.DecayNLLCalculator.totalAmplitudeSquared_comb">[docs]</a>
    <span class="k">def</span> <span class="nf">totalAmplitudeSquared_comb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Bsign</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_p&#39;</span> <span class="k">if</span> <span class="n">Bsign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s1">&#39;_m&#39;</span>
        <span class="n">fracDD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fracDD</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">absA</span><span class="p">,</span> <span class="n">absAbar</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absA</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_absAbar</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">normA</span><span class="p">,</span> <span class="n">normAbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;comb_a&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisations</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;comb_abar&#39;</span><span class="p">]</span>
        <span class="n">eff1</span><span class="p">,</span> <span class="n">eff2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;comb_a&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">eff_arr</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;comb_abar&#39;</span><span class="p">]</span>

        <span class="n">frac1</span> <span class="o">=</span> <span class="n">fracDD</span><span class="o">*</span><span class="mf">0.5</span>
        <span class="n">frac2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">fracDD</span>
        <span class="n">prob1</span> <span class="o">=</span> <span class="n">eff1</span><span class="o">*</span><span class="n">absA</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="n">normA</span>
        <span class="n">prob2</span> <span class="o">=</span> <span class="n">eff2</span><span class="o">*</span><span class="n">absAbar</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="n">normAbar</span> 
        <span class="n">prob3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">absA</span><span class="p">)</span>    
    
        <span class="k">return</span> <span class="p">(</span><span class="n">prob1</span> <span class="o">*</span> <span class="n">frac1</span> <span class="o">+</span> <span class="n">prob2</span> <span class="o">*</span> <span class="n">frac1</span> <span class="o">+</span> <span class="n">prob3</span> <span class="o">*</span> <span class="n">frac2</span><span class="p">)</span></div>
</div>



</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Shenghui Zeng.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>